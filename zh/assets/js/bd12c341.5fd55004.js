"use strict";(self.webpackChunkstarcoin_cookbook=self.webpackChunkstarcoin_cookbook||[]).push([[4931],{3905:function(e,r,t){t.d(r,{Zo:function(){return u},kt:function(){return O}});var a=t(7294);function l(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function n(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);r&&(a=a.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,a)}return t}function c(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?n(Object(t),!0).forEach((function(r){l(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function o(e,r){if(null==e)return{};var t,a,l=function(e,r){if(null==e)return{};var t,a,l={},n=Object.keys(e);for(a=0;a<n.length;a++)t=n[a],r.indexOf(t)>=0||(l[t]=e[t]);return l}(e,r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(a=0;a<n.length;a++)t=n[a],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var i=a.createContext({}),p=function(e){var r=a.useContext(i),t=r;return e&&(t="function"==typeof e?e(r):c(c({},r),e)),t},u=function(e){var r=p(e.components);return a.createElement(i.Provider,{value:r},e.children)},s={inlineCode:"code",wrapper:function(e){var r=e.children;return a.createElement(a.Fragment,{},r)}},d=a.forwardRef((function(e,r){var t=e.components,l=e.mdxType,n=e.originalType,i=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),d=p(t),O=l,k=d["".concat(i,".").concat(O)]||d[O]||s[O]||n;return t?a.createElement(k,c(c({ref:r},u),{},{components:t})):a.createElement(k,c({ref:r},u))}));function O(e,r){var t=arguments,l=r&&r.mdxType;if("string"==typeof e||l){var n=t.length,c=new Array(n);c[0]=d;var o={};for(var i in r)hasOwnProperty.call(r,i)&&(o[i]=r[i]);o.originalType=e,o.mdxType="string"==typeof e?e:l,c[1]=o;for(var p=2;p<n;p++)c[p]=t[p];return a.createElement.apply(null,c)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},5622:function(e,r,t){t.r(r),t.d(r,{assets:function(){return i},contentTitle:function(){return c},default:function(){return s},frontMatter:function(){return n},metadata:function(){return o},toc:function(){return p}});var a=t(3117),l=(t(7294),t(3905));const n={},c="\u9884\u8a00\u673a\u534f\u8bae",o={unversionedId:"move/starcoin-framework/oracle",id:"move/starcoin-framework/oracle",title:"\u9884\u8a00\u673a\u534f\u8bae",description:"Starcoin \u6807\u51c6Oracle\u534f\u8bae\u4ecb\u7ecd",source:"@site/i18n/zh/docusaurus-plugin-content-docs/current/03-move/06-starcoin-framework/7-oracle.md",sourceDirName:"03-move/06-starcoin-framework",slug:"/move/starcoin-framework/oracle",permalink:"/zh/docs/move/starcoin-framework/oracle",draft:!1,editUrl:"https://github.com/starcoinorg/starcoin-cookbook/edit/main/i18n/zh/docusaurus-plugin-content-docs/current/03-move/06-starcoin-framework/7-oracle.md",tags:[],version:"current",sidebarPosition:7,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"DAO",permalink:"/zh/docs/move/starcoin-framework/dao"},next:{title:"\u5982\u4f55\u90e8\u7f72 Move \u667a\u80fd\u5408\u7ea6",permalink:"/zh/docs/move/deploy-first-move-contract"}},i={},p=[{value:"\u4e3a\u4ec0\u4e48\u9700\u8981Oracle\uff1f",id:"\u4e3a\u4ec0\u4e48\u9700\u8981oracle",level:2},{value:"Starcoin\u7684\u6807\u51c6Oracle\u534f\u8bae",id:"starcoin\u7684\u6807\u51c6oracle\u534f\u8bae",level:2},{value:"Starcoin\u7684Oracle\u573a\u666f\u8ba8\u8bba",id:"starcoin\u7684oracle\u573a\u666f\u8ba8\u8bba",level:2},{value:"1. \u5b9e\u65f6\u4ef7\u683c",id:"1-\u5b9e\u65f6\u4ef7\u683c",level:3},{value:"2. \u968f\u673a\u6570\u548c\u94fe\u6e38",id:"2-\u968f\u673a\u6570\u548c\u94fe\u6e38",level:3},{value:"3. \u94fe\u4e0b\u590d\u6742\u8ba1\u7b97",id:"3-\u94fe\u4e0b\u590d\u6742\u8ba1\u7b97",level:3},{value:"4. \u4fdd\u9669\u7406\u8d54",id:"4-\u4fdd\u9669\u7406\u8d54",level:3},{value:"5. \u9884\u6d4b\u5e02\u573a",id:"5-\u9884\u6d4b\u5e02\u573a",level:3},{value:"Starcoin\u7684PriceOracle\u5b9e\u73b0",id:"starcoin\u7684priceoracle\u5b9e\u73b0",level:2},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}],u={toc:p};function s(e){let{components:r,...t}=e;return(0,l.kt)("wrapper",(0,a.Z)({},u,t,{components:r,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"\u9884\u8a00\u673a\u534f\u8bae"},"\u9884\u8a00\u673a\u534f\u8bae"),(0,l.kt)("p",null,"Starcoin \u6807\u51c6Oracle\u534f\u8bae\u4ecb\u7ecd"),(0,l.kt)("h2",{id:"\u4e3a\u4ec0\u4e48\u9700\u8981oracle"},"\u4e3a\u4ec0\u4e48\u9700\u8981Oracle\uff1f"),(0,l.kt)("p",null,"\u533a\u5757\u94fe\u53d1\u5c55\u81f3\u4eca\uff0c\u9047\u5230\u8fc7\u5f88\u591a\u56f0\u96be\uff0c\u8fd9\u4e9b\u56f0\u96be\u7684\u80cc\u540e\u5f80\u5f80\u50ac\u751f\u51fa\u66f4\u591a\u7684\u521b\u65b0\u3002\n\u94fe\u4e0a\u5982\u4f55\u83b7\u53d6\u771f\u5b9e\u4e16\u754c\u7684\u6570\u636e\uff1f\u5408\u7ea6\u5982\u4f55\u6355\u6349\u5e02\u573a\u7684\u4ef7\u683c\u6ce2\u52a8\uff1f\u94fe\u6e38\u5982\u4f55\u4fdd\u8bc1\u4e0d\u53ef\u9884\u6d4b\u6027\uff1f\n\u7c7b\u4f3c\u7684\u5f88\u591a\u7591\u95ee\u56f0\u6270\u7740\u6211\u4eec\uff0cOracle(\u9884\u8a00\u673a)\u5e94\u8fd0\u800c\u751f\u3002\nOracle\u4e0d\u4ec5\u6253\u901a\u4e86\u94fe\u4e0a\u4e0e\u94fe\u4e0b\uff0c\u4e5f\u5728\u516c\u94fe\u4e4b\u95f4\u5f00\u4e86\u4e00\u6247\u95e8\uff0c\u6781\u5927\u7684\u62d3\u5c55\u4e86\u533a\u5757\u94fe\u7684\u5e94\u7528\u573a\u666f\u3002\n\u6240\u4ee5Oracle\u5c31\u50cf\u4e00\u5ea7\u6865\u6881\uff0c\u8ba9\u4e0d\u540c\u5730\u65b9\u7684\u6570\u636e\u76f8\u4e92\u4e4b\u95f4\u5efa\u7acb\u8d77\u8054\u7cfb\u3002"),(0,l.kt)("p",null,"Oracle\u5df2\u6210\u4e3a\u516c\u94fe\u751f\u6001\u4e2d\u5fc5\u5907\u7684\u4e00\u4e2a\u57fa\u7840\u7ec4\u4ef6\u3002\nStarcoin\u4e5f\u5b9a\u4e49\u4e86\u4e00\u5957\u6807\u51c6\u7684Oracle\u534f\u8bae\uff0c\u5b83\u5c31\u50cf\u536b\u661f\u4e00\u6837\uff0c\u5c06\u661f\u7403\u4e0a\u7684\u6570\u636e\u6536\u96c6\u8d77\u6765\uff0c\u518d\u901a\u8fc7Move\u5408\u7ea6\u5206\u53d1\u5230\u5176\u4ed6\u7684\u5730\u65b9\uff0c\u521b\u9020\u4e30\u5bcc\u7684\u4ef7\u503c\u3002"),(0,l.kt)("h2",{id:"starcoin\u7684\u6807\u51c6oracle\u534f\u8bae"},"Starcoin\u7684\u6807\u51c6Oracle\u534f\u8bae"),(0,l.kt)("p",null,"Starcoin\u901a\u8fc7\u667a\u80fd\u5408\u7ea6\u8bed\u8a00Move\uff0c\u5728Stdlib\u4e2d\u8bbe\u8ba1\u4e86\u4e00\u5957\u6807\u51c6\u7684Oracle\u534f\u8bae\uff0c\u62e5\u6709\u4ee5\u4e0b\u7279\u70b9\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u53ef\u6269\u5c55"),(0,l.kt)("li",{parentName:"ul"},"\u5f00\u653e\u7684\u6570\u636e\u6e90"),(0,l.kt)("li",{parentName:"ul"},"\u5b89\u5168\u53ef\u9760"),(0,l.kt)("li",{parentName:"ul"},"\u7b80\u6d01\u9ad8\u6548")),(0,l.kt)("p",null,"\u8be5\u534f\u8bae\u529f\u80fd\u975e\u5e38\u5b8c\u5907\uff0c\u8bbe\u8ba1\u4e0a\u4e5f\u5f88\u7cbe\u70bc\u548c\u5de7\u5999\uff0c\u6211\u4eec\u901a\u8fc7\u6e90\u7801\u6765\u6df1\u5165\u5730\u4e86\u89e3\u4e00\u4e0b\uff1a"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u7075\u6d3b\u7684OracleInfo")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"struct OracleInfo<OracleT: copy+store+drop, Info: copy+store+drop> has key {\n    ///The datasource counter\n    counter: u64,\n    ///Ext info\n    info: Info,\n}\n\npublic fun register_oracle<OracleT: copy+store+drop, Info: copy+store+drop>(_sender: &signer, info: Info) acquires GenesisSignerCapability\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"OracleInfo\u662f\u9762\u5411\u6cdb\u578b\u7f16\u7a0b\u7684\uff0c\u901a\u8fc7\u6cdb\u578b\u53c2\u6570\u652f\u6301\u4efb\u610f\u7c7b\u578b\u7684Info\uff0c\u6709\u975e\u5e38\u826f\u597d\u7684\u6269\u5c55\u6027\u3002"),(0,l.kt)("li",{parentName:"ul"},"OracleInfo\u53ea\u6709key\u7684ability\uff0c\u65e2\u4e0d\u80fdcopy\u4ea7\u751f\u91cd\u590d\u7c7b\u578b\u7684OracleInfo\u5b9e\u4f8b\uff0c\u4e5f\u4e0d\u80fd\u8ba9\u5df2\u6709\u7684OracleInfo\u5b9e\u4f8b\u51ed\u7a7adrop\uff0c\u5b89\u5168\u53ef\u9760\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u6ca1\u6709\u4f7f\u7528\u6570\u7ec4\u5b58\u50a8\uff0c\u5e76\u4e14\u4efb\u4f55\u8d26\u53f7\u90fd\u80fd\u591f\u901a\u8fc7register_oracle\u51fd\u6570\u6ce8\u518cOracleInfo\u3002")),(0,l.kt)("ol",{start:2},(0,l.kt)("li",{parentName:"ol"},"\u4e30\u5bcc\u7684DataSource")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"struct DataSource<OracleT: copy+store+drop, ValueT: copy+store+drop> has key {\n    /// the id of data source of ValueT\n    id: u64,\n    /// the data version counter.\n    counter: u64,\n    update_events: Event::EventHandle<OracleUpdateEvent<OracleT, ValueT>>,\n}\n\npublic fun init_data_source<OracleT:  copy+store+drop, Info: copy+store+drop, ValueT: copy+store+drop>(sender: &signer, init_value: ValueT) acquires OracleInfo\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u4efb\u4f55\u8d26\u53f7\u90fd\u53ef\u4ee5\u8c03\u7528init_data_source\u51fd\u6570\u6210\u4e3aDataSource\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u66f4\u65b0\u51ed\u8bc1UpdateCapability\u7b49\u6570\u636e\u5b58\u50a8\u5728\u5f53\u524d\u8d26\u53f7\u4e0b\uff0c\u62e5\u6709\u660e\u786e\u7684\u6240\u6709\u6743\u3002")),(0,l.kt)("ol",{start:3},(0,l.kt)("li",{parentName:"ol"},"\u5408\u7406\u7684\u6743\u9650\u7ba1\u7406")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"struct UpdateCapability<OracleT: copy+store+drop> has store, key {\n    account: address,\n}\n\nstruct GenesisSignerCapability has key{\n    cap: Account::SignerCapability,\n}\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u5b9a\u4e49\u4e86\u4e24\u79cd\u4e0d\u540c\u7684\u6743\u9650\uff1aOracleInfo\u6ce8\u518c\u7684\u6743\u9650GenesisSignerCapability\u3001OracleFeed\u66f4\u65b0\u7684\u6743\u9650UpdateCapability\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u53ea\u6709GENESIS_ADDRESS\u62e5\u6709GenesisSignerCapability\uff0c\u901a\u8fc7\u5916\u501f\u7684\u65b9\u5f0f\uff0c\u8ba9\u6240\u6709\u4eba\u90fd\u80fd\u6ce8\u518cOracleInfo\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u4efb\u4f55\u8d26\u53f7\u90fd\u53ef\u4ee5\u6709UpdateCapability\uff0c\u4efb\u4f55\u6709UpdateCapability\u7684\u8d26\u53f7\u90fd\u80fd\u66f4\u65b0\u5bf9\u5e94\u7c7b\u578b\u7684OracleFeed\u6570\u636e\u3002")),(0,l.kt)("ol",{start:4},(0,l.kt)("li",{parentName:"ol"},"\u5b89\u5168\u7684OracleFeed")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"struct DataRecord<ValueT: copy+store+drop> has copy, store, drop {\n    ///The data version\n    version: u64,\n    ///The record value\n    value: ValueT,\n    ///Update timestamp millisecond\n    updated_at: u64,\n}\n\nstruct OracleFeed<OracleT: copy+store+drop, ValueT: copy+store+drop> has key {\n    record: DataRecord<ValueT>,\n}\n\npublic fun update<OracleT: copy+store+drop, ValueT: copy+store+drop>(sender: &signer, value: ValueT) acquires UpdateCapability, DataSource, OracleFeed\n\npublic fun update_with_cap<OracleT: copy+store+drop, ValueT: copy+store+drop>(cap: &mut UpdateCapability<OracleT>, value: ValueT) acquires DataSource,OracleFeed\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"DataRecord\u5b58\u50a8\u771f\u5b9e\u6570\u636e\uff0c\u6709\u4e25\u683c\u7684version\u7248\u672c\u63a7\u5236\u548cupdated_at\u94fe\u4e0a\u65f6\u95f4\u6233\u3002"),(0,l.kt)("li",{parentName:"ul"},"OracleFeed\u53ea\u6709key\u7684ability\uff0c\u4e0d\u80fdcopy\u548cdrop\uff0c\u5b89\u5168\u53ef\u9760\u3002"),(0,l.kt)("li",{parentName:"ul"},"OracleFeed<OracleT: copy+store+drop, ValueT: copy+store+drop>\u7684\u5f53\u524d\u8d26\u53f7\u4e0b\u552f\u4e00\uff0c\u53ea\u4fdd\u7559\u6700\u65b0\u7684\u6570\u636e\uff0c\u907f\u514d\u8bfb\u5230\u8fc7\u671f\u7684\u6570\u636e\u3002"),(0,l.kt)("li",{parentName:"ul"},"OracleFeed\u901a\u8fc7update\u51fd\u6570\u548cupdate_with_cap\u51fd\u6570\u66f4\u65b0\uff0c\u4e0d\u7ba1\u662f\u54ea\u4e2a\u51fd\u6570\uff0c\u90fd\u9700\u8981UpdateCapability\uff0c\u907f\u514d\u88ab\u522b\u4eba\u8bef\u66f4\u65b0\uff0c\u4fdd\u969c\u6570\u636e\u5b89\u5168\u3002")),(0,l.kt)("p",null,"Starcoin\u7684\u6807\u51c6Oracle\u534f\u8bae\u5728\u7ed3\u6784\u4e0a\u4fdd\u6301\u7b80\u6d01\u9ad8\u6548\uff0c\u5f88\u597d\u5730\u5e94\u7528\u4e86Move\u7684\u4f18\u52bf\uff0c\u62e5\u6709\u975e\u5e38\u597d\u7684\u5b89\u5168\u6027\u548c\u53ef\u6269\u5c55\u80fd\u529b\u3002"),(0,l.kt)("h2",{id:"starcoin\u7684oracle\u573a\u666f\u8ba8\u8bba"},"Starcoin\u7684Oracle\u573a\u666f\u8ba8\u8bba"),(0,l.kt)("p",null,"\u524d\u9762\u6211\u4eec\u91cd\u70b9\u4ecb\u7ecd\u4e86\u6807\u51c6Oracle\u534f\u8bae\u7684\u5b9e\u73b0\u7ec6\u8282\uff0c\u63a5\u4e0b\u6765\u629b\u7816\u5f15\u7389\uff0c\u63a2\u8ba8\u4e00\u4e0bStarcoin\u7684Oracle\u53ef\u80fd\u7684\u5e94\u7528\u573a\u666f\u3002"),(0,l.kt)("h3",{id:"1-\u5b9e\u65f6\u4ef7\u683c"},"1. \u5b9e\u65f6\u4ef7\u683c"),(0,l.kt)("p",null,"\u7528\u6237\u53ef\u4ee5\u4ece\u4e0d\u540c\u7684\u6570\u636e\u6e90\u91c7\u96c6\u52a0\u5bc6\u8d27\u5e01\u7684\u65f6\u95f4\u548c\u4ef7\u683c\u6570\u636e\uff0c\u901a\u8fc7Oracle\u4ee5\u63a5\u8fd1\u5b9e\u65f6\u7684\u65b9\u5f0f\u63d0\u4ea4\u5230\u94fe\u4e0a\u3002\n\u5176\u4ed6\u5408\u7ea6\u53ef\u4ee5\u901a\u8fc7\u7b5b\u9009\u6570\u636e\u6e90\uff0c\u76f4\u63a5\u4f7f\u7528\u8fd9\u4e9b\u6570\u636e\uff0c\u6216\u8005\u805a\u5408\u5904\u7406\u4e4b\u540e\u4f7f\u7528\u8fd9\u4e9b\u6570\u636e\uff0c\u975e\u5e38\u7684\u65b9\u4fbf\u548c\u7075\u6d3b\u3002"),(0,l.kt)("h3",{id:"2-\u968f\u673a\u6570\u548c\u94fe\u6e38"},"2. \u968f\u673a\u6570\u548c\u94fe\u6e38"),(0,l.kt)("p",null,"\u6211\u4eec\u90fd\u77e5\u9053\u5728\u8f93\u5165\u786e\u5b9a\u7684\u60c5\u51b5\u4e0b\uff0c\u667a\u80fd\u5408\u7ea6\u5fc5\u987b\u4fdd\u8bc1\u6240\u6709\u4eba\u7684\u6267\u884c\u7ed3\u679c\u662f\u4e00\u81f4\u7684\uff0c\u6240\u4ee5\u94fe\u4e0a\u5f88\u96be\u63d0\u4f9b\u7c7b\u4f3c\u968f\u673a\u6570\u7684\u673a\u5236\u3002\n\u800c\u901a\u8fc7Oracle\uff0c\u7528\u6237\u53ef\u4ee5\u5c06 VRF \u968f\u673a\u6570\u636e\u63d0\u4ea4\u5230\u94fe\u4e0a\uff0c\u8fd9\u6837\u65e2\u80fd\u9a8c\u8bc1\u968f\u673a\u6570\u7684\u6b63\u786e\u6027\uff0c\u53c8\u80fd\u8ba9\u5408\u7ea6\u62e5\u6709\u968f\u673a\u7684\u80fd\u529b\u800c\u589e\u52a0\u66f4\u4e30\u5bcc\u7684\u573a\u666f\u3002"),(0,l.kt)("p",null,"\u4ee5\u6e38\u620f\u4e3a\u4f8b\uff0c\u4e0d\u53ef\u9884\u6d4b\u6027\u662f\u6e38\u620f\u5177\u6709\u5438\u5f15\u529b\u7684\u91cd\u8981\u7684\u56e0\u7d20\u4e4b\u4e00\u3002\u6e38\u620f\u901a\u8fc7Oracle\u83b7\u53d6\u968f\u673a\u6570\uff0c\u53ef\u4ee5\u4fdd\u969c\u6e38\u620f\u7684\u4e0d\u53ef\u9884\u6d4b\u6027\u3002"),(0,l.kt)("p",null,"\u5f53\u7136\uff0c\u968f\u673a\u6570\u8fd8\u6709\u66f4\u591a\u7684\u5e94\u7528\u573a\u666f\uff0c\u6bd4\u5982\u7ea2\u5305\u3001\u6a21\u62df\u4e0d\u786e\u5b9a\u7684\u73af\u5883\u7b49\u7b49\u3002"),(0,l.kt)("h3",{id:"3-\u94fe\u4e0b\u590d\u6742\u8ba1\u7b97"},"3. \u94fe\u4e0b\u590d\u6742\u8ba1\u7b97"),(0,l.kt)("p",null,"\u7531\u4e8eGas\u3001\u5355\u7ebf\u7a0b\u7b49\u9650\u5236\uff0c\u667a\u80fd\u5408\u7ea6\u4e2d\u4e0d\u80fd\u6709\u590d\u6742\u7684\u8ba1\u7b97\u903b\u8f91\uff0c\u8fd9\u4f1a\u8ba9\u667a\u80fd\u5408\u7ea6\u7684\u573a\u666f\u975e\u5e38\u53d7\u9650\u3002\n\u5982\u679c\u901a\u8fc7\u67d0\u79cd\u7c7b\u4f3cProof\u7684\u65b9\u6848\uff0c\u8ba9\u590d\u6742\u7684\u8ba1\u7b97\u5728\u94fe\u4e0b\u6267\u884c\uff0c\u7136\u540e\u628a\u7ed3\u679c\u548cProof\u63d0\u4ea4\u5230\u94fe\u4e0a\u7684Oracle\u4e2d\uff0c\u63d0\u4f9b\u7ed9\u5176\u4ed6\u5408\u7ea6\u4f7f\u7528\uff0c\u4f1a\u5927\u5927\u964d\u4f4e\u667a\u80fd\u5408\u7ea6\u7684\u8bbe\u8ba1\u96be\u5ea6\uff0c\u540c\u65f6\uff0c\u80fd\u591f\u4e30\u5bcc\u667a\u80fd\u5408\u7ea6\u7684\u5e94\u7528\u573a\u666f\u3002"),(0,l.kt)("h3",{id:"4-\u4fdd\u9669\u7406\u8d54"},"4. \u4fdd\u9669\u7406\u8d54"),(0,l.kt)("p",null,"\u4fdd\u9669\u662f\u4e00\u4e2a\u91cd\u8981\u7684\u91d1\u878d\u573a\u666f\uff0c\u4f46\u662f\u4e5f\u4e00\u76f4\u5b58\u5728\u5404\u79cd\u4e0d\u89c4\u8303\u7684\u73b0\u8c61\uff0c\u6bd4\u5982\u9a97\u4fdd\u7b49\u7b49\u3002\u667a\u80fd\u5408\u7ea6\u5373\u6cd5\u5f8b\uff0c\u5982\u679c\u4f7f\u7528Oracle\u5c06\u4e8b\u4ef6\u4e0a\u94fe\uff0c\u518d\u901a\u8fc7\u5408\u7ea6\u6765\u9274\u5b9a\u548c\u6267\u884c\uff0c\u5c06\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u7ed3\u5408\u3002\u4f8b\u5982\uff0c\u5e38\u89c1\u7684\u822a\u73ed\u5ef6\u8bef\u9669\u3001\u6559\u80b2\u91d1\u4fdd\u9669\u7b49\u7b49\uff0c\u90fd\u80fd\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0c\u89c4\u8303\u5e02\u573a\uff0c\u63d0\u5347\u6548\u7387\u3002"),(0,l.kt)("h3",{id:"5-\u9884\u6d4b\u5e02\u573a"},"5. \u9884\u6d4b\u5e02\u573a"),(0,l.kt)("p",null,"\u5e02\u573a\u662f\u77ac\u606f\u4e07\u53d8\u7684\uff0c\u4efb\u4f55\u94fe\u4e0b\u7684\u4e8b\u4ef6\u4ea7\u751f\uff0c\u90fd\u53ef\u4ee5\u901a\u8fc7Oracle\u5feb\u901f\u6620\u5c04\u5230\u94fe\u4e0a\u3002\n\u667a\u80fd\u5408\u7ea6\u901a\u8fc7\u83b7\u53d6Oracle\u63d0\u4f9b\u7684\u6570\u636e\uff0c\u89e6\u53d1\u9884\u6d4b\u5e02\u573a\u6267\u884c\u7ed3\u7b97\u7b49\u64cd\u4f5c\u3002\u4f8b\u5982\uff0c\u4f53\u80b2\u7ade\u6280\u7ed3\u679c\u3001\u9ec4\u91d1\u4ef7\u683c\u53d8\u5316\u3001\u7535\u7ade\u7b49\u7b49\u3002"),(0,l.kt)("h2",{id:"starcoin\u7684priceoracle\u5b9e\u73b0"},"Starcoin\u7684PriceOracle\u5b9e\u73b0"),(0,l.kt)("p",null,"\u6211\u4eec\u6df1\u5165\u4e86\u89e3\u4e86Starcoin\u6807\u51c6Oracle\u534f\u8bae\u7684\u8bbe\u8ba1\uff0c\u7136\u540e\u63a2\u8ba8\u4e86\u5176\u4e30\u5bcc\u7684\u5e94\u7528\u573a\u666f\u3002\n\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u4ee5\u5e02\u573a\u4ef7\u683c\u7684\u573a\u666f\u4e3a\u4f8b\uff0c\u4e86\u89e3\u4e00\u4e0b\u5982\u4f55\u5728\u6807\u51c6\u7684Oracle\u534f\u8bae\u4e4b\u4e0a\uff0c\u5c06\u7279\u5b9a\u573a\u666f\u7684\u4e1a\u52a1\u903b\u8f91\u6dfb\u52a0\u8fdb\u53bb\uff0c\u5b9e\u73b0\u4e00\u4e2a\u5b8c\u6574\u7684Oracle\u5e94\u7528\u3002"),(0,l.kt)("p",null,"Starcoin\u5728\u6807\u51c6\u7684Oracle\u534f\u8bae\u4e4b\u4e0a\u5c01\u88c5\u4e86\u4e00\u4e2aPriceOracle\u6a21\u5757\uff0c\u9488\u5bf9\u4ef7\u683c\u573a\u666f\u505a\u4e86\u5b98\u65b9\u7684\u5b9e\u73b0\u3002\nPriceOracle\u4e5f\u662f\u4e00\u4e2a\u901a\u7528\u7684\u5408\u7ea6\uff0c\u80fd\u591f\u6ce8\u518c\u4efb\u610f\u7c7b\u578b\u7684\u6570\u5b57\u8d44\u4ea7\u3002\n\u7136\u540e\uff0cStarcoin\u5728PriceOracle\u4e4b\u4e0a\uff0c\u5b9e\u73b0\u4e86\u4e00\u4e2aSTCUSDOracle\u5408\u7ea6\uff0c\u6ce8\u518c\u4e86\u4e00\u5bf9\u8d27\u5e01\u7ec4\u5408STC\u548cUSDT\u3002\n\u518d\u901a\u8fc7PriceOracleScript\u5408\u7ea6\uff0c\u5c06STC\u5bf9\u5e94USD\u7684\u4ef7\u683c\u6ce8\u518c\u5230\u94fe\u4e0a\u7684Oracle\u4e2d\u3002\n\u6700\u540e\uff0c\u4efb\u4f55\u4eba\u53ef\u4ee5\u901a\u8fc7PriceOracleAggregator\u805a\u5408\u5668\u5bf9\u4ef7\u683c\u8fdb\u884c\u7b5b\u9009\u3001\u8fc7\u6ee4\uff0c\u5c06\u805a\u5408\u5f97\u5230\u7684\u4ef7\u683c\u5e94\u7528\u5230\u81ea\u5df1\u7684\u4ea7\u54c1\u4e2d\u3002\n\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u6765\u6df1\u5165\u7684\u5206\u6790\u4e00\u4e0bPriceOracle\u3001STCUSDOracle\u4ee5\u53caPriceOracleAggregator\u7684\u6e90\u7801\u3002"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"PriceOracle")),(0,l.kt)("p",null,"PriceOracle\u5efa\u7acb\u5728\u6807\u51c6\u7684Oracle\u534f\u8bae\u4e4b\u4e0a\uff0c\u662f\u9488\u5bf9\u4ef7\u683c\u573a\u666f\u5b9e\u73b0\u7684\u4e00\u4e2a\u901a\u7528\u5408\u7ea6\u3002\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u4efb\u4f55Price\u5f62\u6001\u7684\u6570\u636e\uff0c\u90fd\u53ef\u4ee5\u901a\u8fc7PriceOracle\u4e0a\u94fe\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"struct PriceOracleInfo has copy,store,drop{\n    scaling_factor: u128,\n}\n")),(0,l.kt)("p",null,"\u5728\u6807\u51c6\u7684Oracle\u534f\u8bae\u4e2d\uff0cOracleInfo\u6709\u4e00\u4e2a\u6cdb\u578b\u53c2\u6570\u662fInfo: copy+store+drop\u3002\n\u5728PriceOracle\u4e2d\uff0cInfo\u5bf9\u5e94\u7684\u5177\u4f53\u5b9e\u73b0\u662fPriceOracleInfo\uff0c\u91cc\u9762\u53ea\u5305\u542b\u4e86\u8ba1\u7b97\u56e0\u5b50scaling_factor\uff0c\u6240\u4ee5PriceOracleInfo\u5fc5\u987b\u6709copy\u3001store\u3001drop\u8fd93\u79cdability\uff0c\u8fd9\u662fInfo\u8fd9\u4e2a\u6cdb\u578b\u53c2\u6570\u7684\u8981\u6c42\u3002"),(0,l.kt)("p",null,"\u5728\u660e\u786e\u4e86PriceOracleInfo\u7684\u6570\u636e\u5b9a\u4e49\u4e4b\u540e\uff0c\u53ef\u4ee5\u8c03\u7528Oracle\u5408\u7ea6\u7684register_oracle\u51fd\u6570\u6ce8\u518cPriceOracleInfo\uff0c\u8fd8\u53ef\u4ee5\u8c03\u7528Oracle\u7684init_data_source\u548cupdate\u5c06\u6570\u636e\u4e0a\u94fe\u3002"),(0,l.kt)("p",null,"PriceOracle\u662f\u6807\u51c6Oracle\u534f\u8bae\u4e0a\u9762\u7684\u4e00\u4e2a\u5e94\u7528\uff0c\u6240\u4ee5\u7ee7\u627f\u4e86Oracle\u534f\u8bae\u6240\u6709\u7684\u7279\u6027\uff0c\u4f7f\u7528\u975e\u5e38\u4fbf\u6377\u3002"),(0,l.kt)("ol",{start:2},(0,l.kt)("li",{parentName:"ol"},"STCUSDTOracle")),(0,l.kt)("p",null,"\u5982\u679c\u8bf4PriceOracle\u662f\u4ef7\u683c\u7684\u901a\u7528\u5408\u7ea6\uff0c\u90a3\u4e48STCUSDTOracle\u5408\u7ea6\u662f\u4ef7\u683c\u573a\u666f\u5177\u4f53\u5b9e\u73b0\u7684\u4e00\u4e2a\u4ea7\u54c1\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"struct STCUSD has copy,store,drop {}\n")),(0,l.kt)("p",null,"\u6211\u4eec\u770b\u5230\uff0c\u5728\u6807\u51c6\u7684Oracle\u534f\u8bae\u4e2d\uff0cOracleInfo\u9664\u4e86Info\uff0c\u8fd8\u6709\u53e6\u5916\u4e00\u4e2a\u6cdb\u578b\u53c2\u6570OracleT: copy+store+drop\uff0cOracleT\u8868\u793a\u4e00\u5bf9\u8d27\u5e01\u7ec4\u5408\uff0cInfo\u8868\u793a\u4fe1\u606f\u3002\nPriceOracle\u53ea\u5b9e\u73b0\u4e86PriceOracleInfo\uff0cOracleT\u5728PriceOracle\u4e5f\u662f\u6cdb\u578b\u53c2\u6570\uff0c\u800cSTCUSDTOracle\u5408\u7ea6\u7684\u6700\u5927\u4f5c\u7528\u5c31\u662f\u786e\u5b9aOracleT\u7684\u7c7b\u578b\u4e3aSTCUSD\u3002\n\u5f53\u7136\uff0c\u4efb\u4f55\u4eba\u53ef\u4ee5\u5b9e\u73b0\u5c5e\u4e8e\u81ea\u5df1\u7684\u4e00\u5bf9\u8d27\u5e01\u7ec4\u5408\u5408\u7ea6\uff0c\u5b9a\u4e49\u81ea\u5df1\u7684\u4ea7\u54c1\u3002"),(0,l.kt)("ol",{start:3},(0,l.kt)("li",{parentName:"ol"},"PriceOracleScript")),(0,l.kt)("p",null,"PriceOracleScript\u662f\u4e3a\u4ea4\u6613\u5b9a\u4e49\u7684\u4e00\u4e9b\u811a\u672c\uff0c\u8fd9\u662f\u4e00\u4e2a\u91cd\u8981\u7684\u7528\u6237\u5165\u53e3\uff0c\u4e3b\u8981\u7528\u4e8e\u66f4\u65b0Oracle\u6570\u636e\uff0c\u5305\u62ec\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u6ce8\u518c\u4efb\u610f\u4e00\u5bf9\u8d27\u5e01\u7ec4\u5408OracleT\u7684PriceOracleInfo"),(0,l.kt)("li",{parentName:"ul"},"\u66f4\u65b0\u4efb\u610f\u4e00\u5bf9\u8d27\u5e01\u7ec4\u5408OracleT\u7684\u6700\u65b0\u6570\u636e")),(0,l.kt)("ol",{start:4},(0,l.kt)("li",{parentName:"ol"},"PriceOracleAggregator")),(0,l.kt)("p",null,"PriceOracleAggregator\u5408\u7ea6\u662f\u4e00\u4e2a\u805a\u5408\u5668\uff0c\u5bf9Oracle\u4e2d\u7684\u6570\u636e\u8fdb\u884c\u7b5b\u9009\u3001\u8fc7\u6ee4\uff0c\u7136\u540e\u5c06\u805a\u5408\u4e4b\u540e\u7684\u4ef7\u683c\u8fd4\u56de\u7ed9\u7528\u6237\uff0c\u5c06\u94fe\u4e0a\u5b9e\u65f6\u4ef7\u683c\u5e94\u7528\u5230\u4efb\u4f55\u9700\u8981\u7684\u5730\u65b9\u3002"),(0,l.kt)("h2",{id:"\u603b\u7ed3"},"\u603b\u7ed3"),(0,l.kt)("p",null,"Starcoin\u4e0d\u4ec5\u4ec5\u5b9e\u73b0\u4e86\u4e00\u4e2a\u6807\u51c6\u7684Oracle\u534f\u8bae\uff0c\u800c\u662f\u5b9e\u73b0\u4e86\u4e00\u5957\u975e\u5e38\u5b8c\u6574\u7684Oracle\u5de5\u5177\u94fe\u3002"),(0,l.kt)("p",null,"\u4ece\u6280\u672f\u7684\u89d2\u5ea6\u5206\u6790\uff0c\u4ece\u6700\u57fa\u7840\u7684\u6807\u51c6Oracle\u534f\u8bae\uff0c\u5230\u9488\u5bf9\u4ef7\u683c\u573a\u666f\u8bbe\u8ba1\u7684PriceOracle\uff0c\u6700\u540e\u5230\u7528\u6237\u7684\u4ea4\u6613\u5165\u53e3\uff0c\u4efb\u4f55\u73af\u8282\u90fd\u505a\u5230\u4e86\u53ef\u5feb\u901f\u6269\u5c55\uff0c\u5e76\u4e14\u5b89\u5168\u53ef\u9760\u3002"),(0,l.kt)("p",null,"\u4ece\u5e94\u7528\u573a\u666f\u7684\u89d2\u5ea6\u5206\u6790\uff0cStarcoin\u7684Oracle\u62e5\u6709\u5e7f\u9614\u7684\u5e94\u7528\u573a\u666f\uff0c\u4f8b\u5982\u5b9e\u65f6\u4ef7\u683c\u3001\u6bd4\u8d5b\u7ed3\u679c\u3001\u6e38\u620f\u3001\u4fdd\u9669\u7406\u8d54\u3001\u590d\u6742\u94fe\u4e0b\u8ba1\u7b97\u7ed3\u679c\u7b49\u7b49\uff0c\u5305\u62ec\u4efb\u4f55\u573a\u666f\u7684\u6709\u4ef7\u503c\u7684\u6570\u636e\u3002"),(0,l.kt)("p",null,"\u4ece\u4ea7\u54c1\u843d\u5730\u7684\u89d2\u5ea6\u5206\u6790\uff0c\u534f\u8bae\u4e0a\u7b80\u6d01\u9ad8\u6548\uff0c\u6570\u636e\u6e90\u548c\u6570\u636e\u90fd\u5b8c\u5168\u5f00\u653e\u3002\u4efb\u4f55\u4eba\u90fd\u53ef\u4ee5\u63d0\u4ea4\u81ea\u5df1\u7684\u6570\u636e\u3002\u4efb\u4f55\u4eba\u53ea\u9700\u8981\u901a\u8fc7\u805a\u5408\u5668\u5c31\u80fd\u5f97\u5230\u5b9e\u65f6\u7684\u94fe\u4e0a\u6570\u636e\uff0c\u4f7f\u7528\u975e\u5e38\u7684\u65b9\u4fbf\u3002"),(0,l.kt)("p",null,"\u6211\u4eec\u6709\u7406\u7531\u76f8\u4fe1Starcoin\u7684Oracle\u975e\u5e38\u7684\u60f3\u8c61\u529b\u548c\u7ade\u4e89\u529b\u3002"))}s.isMDXComponent=!0}}]);